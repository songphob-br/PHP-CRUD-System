<?php
// เรียกไฟล์เชื่อมต่อฐานข้อมูล
include 'db.php';

// ตรวจสอบว่ามีค่า id ส่งมาหรือไม่ (ผ่าน URL เช่น delete.php?id=1)
if (!isset($_GET['id'])) {

  // ถ้าไม่มี id ให้กลับไปหน้า index
  header("Location: index.php");
  exit; // หยุดการทำงานทันที
}

// รับค่า id จาก URL
$id = $_GET['id'];

/* =========================
   ดึงชื่อรูปภาพจากฐานข้อมูล
   ========================= */

// ค้นหาข้อมูลรูปภาพของสินค้าที่ต้องการลบ
$result = $conn->query("SELECT img FROM products WHERE id = $id");

// ดึงข้อมูลออกมาเป็น array
$row = $result->fetch_assoc();

if ($row) {

  // เก็บชื่อไฟล์รูปไว้ในตัวแปร
  $img = $row['img'];

  /* =========================
     ลบไฟล์รูปภาพออกจากโฟลเดอร์
     ========================= */

  // ตรวจสอบว่ามีชื่อรูป และไฟล์นั้นมีอยู่จริง
  if (!empty($img) && file_exists("uploads/$img")) {

    // ลบไฟล์ออกจากโฟลเดอร์ uploads
    unlink("uploads/$img");
  }

  /* =========================
     ลบข้อมูลออกจากฐานข้อมูล
     ========================= */

  // ลบข้อมูลสินค้าตาม id
  $conn->query("DELETE FROM products WHERE id = $id");
}

// หลังลบเสร็จ ให้กลับไปหน้า index
header("Location: index.php");
exit; // หยุดการทำงาน
?>

